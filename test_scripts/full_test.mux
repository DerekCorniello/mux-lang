const int MAX = 100
auto flt = 7.82
auto message = "Mux Parser Test"

enum Shape { Circle(float radius), Rectangle(float width, float height), Square(float size) }

interface Drawable { func draw() returns void }

class Circle is Drawable, ShapeLike {
    float radius
    func draw() returns void { print("Circle radius=" + self.radius.to_string()) }
    func resize(float newRadius, string _) returns void { radius = newRadius }
}

class Stack<T> {
    list<T> items
    func push(T item) returns void { self.items.push_back(item) }
    func pop() returns Optional<T> {
        if self.items.is_empty() { return None }
        return self.items.pop_back()
    }
}

func divide(int a, int b) returns Result<int, string> {
    if b == 0 { return Err("Division by zero") }
    return Ok(a / b)
}

func findEven(list<int> nums) returns Optional<int> {
    for int n in nums { if n % 2 == 0 { return Some(n) } }
    return None
}

func map<T, U>(list<T> items, func(T) returns U transform) returns list<U> {
    list<U> out = []
    for T item in items { out.push_back(transform(item)) }
    return out
}

func main() returns void {
    int explicit = 10
    print("explicit: " + explicit.to_string())
    auto inferred = 42
    print("inferred: " + inferred.to_string())
    auto floatVal = 9.4
    print("floatVal: " + floatVal.to_string())

    if inferred > 40 { print("Big number") } else { print("Small number") }

    auto maybeNum = Some(15)
    print("maybeNum created")
    match maybeNum {
        Some(v) if v > 10 { print("Large value: " + v.to_string()) }
        Some(v) { print("Small value: " + v.to_string()) }
        None { print("No value") }
        _ { print("Unexpected") }
    }

    auto nums = [1, 2, 3]
    print("nums: " + nums.to_string())
    auto c1 = Circle.new()
    c1.radius = 2.0
    print("c1.radius set to: " + c1.radius.to_string())
    auto c2 = Circle.new()
    c2.radius = 3.5
    print("c2.radius set to: " + c2.radius.to_string())
    auto cirs = [c1, c2]
    print("cirs created with 2 circles")
    for Circle c in cirs { c.draw() }

    auto stack = Stack<int>.new()
    print("stack created")
    stack.push(99)
    print("pushed 99 to stack")
    auto popped = stack.pop()
    match popped {
        Some(val) {
            print("popped from stack: " + val.to_string())
        }
        None {
            print("nothing popped")
        }
    }

    auto res = divide(10, 2)
    print("divide(10, 2) result:")
    match res { Ok(v) { print(v.to_string()) } Err(e) { print(e) } }
    match res {
        Ok(v) {
            print("got a good val")
        }
        Err(e) {
            print("got a bad val")
        }
    }

    auto maybeEven = findEven([1, 3, 4, 7])
    print("findEven([1, 3, 4, 7]):")
    match maybeEven { Some(v) { print(v.to_string()) } None { print("None") } }

    auto square = func(int n) returns int { return n * n }
    print("square function created")
    auto doubled = map([1, 2, 3], func(int x) returns int { return x * 2 })
    print("doubled: " + doubled.to_string())
    auto squared = map([1, 2, 3], square)
    print("squared: " + squared.to_string())

    int val = 10
    print("val: " + val.to_string())
    auto p = &val
    print("pointer p created")
    *p = 20
    print("val after deref assignment: " + val.to_string())
    print("full_test passes")
}
